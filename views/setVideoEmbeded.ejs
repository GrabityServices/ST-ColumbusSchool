<!DOCTYPE html>
<html>
  <head>
    <title>Add New Video</title>
  </head>
  <body>
    <h1>Add New Embedded Video</h1>
    <form id="videoForm">
      <textarea
        name="videoEmbed"
        id="videoEmbed"
        rows="6"
        cols="60"
        placeholder="Paste iframe embed code here..."
      ></textarea>
      <br /><br />
      <button type="submit">Submit</button>
    </form>
    <div id="message" style="margin-top: 10px"></div>

    <script>
      document
        .getElementById("videoForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();

          const videoEmbed = document.getElementById("videoEmbed").value.trim();
          const messageBox = document.getElementById("message");
          try {
            const response = await fetch("/home/video/embedded/new", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ videoEmbed }),
            });

            const result = await response.json();
            if (response.ok || result.code === "ok") {
              window.location.href = "/stcolumbus/jaj/ekdara/admin#video";
            } else {
              messageBox.innerText = result.message+" (Error Code: "+(result.code||result.status)+")";
              messageBox.style.color = "red";
            }
          } catch (err) {
            messageBox.innerText = "An error occurred. Please try again.";
            messageBox.style.color = "red";
          }
        });
    </script>
  </body>
</html>
